import * as fs from 'fs'
import * as path from 'path'
import { fileURLToPath } from 'url'

/**
 * æ„å»ºæ—¶è„šæœ¬ï¼šæ‰«æ icons æ–‡ä»¶å¤¹ï¼Œç”Ÿæˆå›¾æ ‡æ˜ å°„æ–‡ä»¶
 * è¿è¡Œæ–¹å¼: tsx scripts/generate-icons.ts
 */

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

const ICONS_DIR = path.join(__dirname, '../icons')
const ICONS_MAP_FILE = path.join(__dirname, '../src/icons-map.ts')
const ICONS_EXPORTS_FILE = path.join(__dirname, '../src/icons-exports.ts')

// è¯»å–æ‰€æœ‰ SVG æ–‡ä»¶
const iconFiles = fs.readdirSync(ICONS_DIR).filter(file => file.endsWith('.svg'))

// å°†æ–‡ä»¶åè½¬æ¢ä¸ºå›¾æ ‡åï¼ˆkebab-case -> PascalCaseï¼‰
function fileNameToIconName(fileName: string): string {
  return fileName
    .replace(/\.svg$/, '')
    .split('-')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join('')
}

// è¯»å– SVG å†…å®¹å¹¶ç”Ÿæˆæ˜ å°„
const iconsMap: Record<string, string> = {}

for (const file of iconFiles) {
  const filePath = path.join(ICONS_DIR, file)
  const svgContent = fs.readFileSync(filePath, 'utf-8')
  const iconName = fileNameToIconName(file)
  iconsMap[iconName] = svgContent
}

// ç”Ÿæˆ TypeScript æ–‡ä»¶
const fileNames = iconFiles.map(f => f.replace(/\.svg$/, '')).sort()
const iconNames = Object.keys(iconsMap).sort()

// ç”Ÿæˆ icons-map.ts
const iconsMapOutput = `// æ­¤æ–‡ä»¶ç”± scripts/generate-icons.ts è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘
// Auto-generated by scripts/generate-icons.ts, do not edit manually

/**
 * å›¾æ ‡ SVG å†…å®¹æ˜ å°„è¡¨
 * é”®ä¸ºå›¾æ ‡åï¼ˆPascalCaseï¼‰ï¼Œå€¼ä¸º SVG å­—ç¬¦ä¸²
 */
export const iconsMap: Record<string, string> = ${JSON.stringify(iconsMap, null, 2)}

/**
 * æ‰€æœ‰å¯ç”¨çš„å›¾æ ‡åç§°åˆ—è¡¨ï¼ˆPascalCaseï¼‰
 */
export const iconNames: string[] = ${JSON.stringify(iconNames, null, 2)}

/**
 * æ‰€æœ‰å¯ç”¨çš„å›¾æ ‡æ–‡ä»¶ååˆ—è¡¨ï¼ˆkebab-caseï¼‰
 */
export const iconFileNames: string[] = ${JSON.stringify(fileNames, null, 2)}
`

fs.writeFileSync(ICONS_MAP_FILE, iconsMapOutput, 'utf-8')

// ç”Ÿæˆæ‰€æœ‰å›¾æ ‡çš„å¯¼å‡ºæ–‡ä»¶
const exportsOutput = `// æ­¤æ–‡ä»¶ç”± scripts/generate-icons.ts è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘
// Auto-generated by scripts/generate-icons.ts, do not edit manually

import { createIconFromLocal } from './iconFactory'

${iconNames.map(name => `export const ${name} = createIconFromLocal('${name}')`).join('\n')}
`

fs.writeFileSync(ICONS_EXPORTS_FILE, exportsOutput, 'utf-8')

console.log(`âœ… å·²ç”Ÿæˆ ${iconNames.length} ä¸ªå›¾æ ‡çš„æ˜ å°„æ–‡ä»¶: ${ICONS_MAP_FILE}`)
console.log(`âœ… å·²ç”Ÿæˆ ${iconNames.length} ä¸ªå›¾æ ‡çš„å¯¼å‡ºæ–‡ä»¶: ${ICONS_EXPORTS_FILE}`)
console.log(`ğŸ“¦ å›¾æ ‡åˆ—è¡¨: ${iconNames.slice(0, 10).join(', ')}...`)

